#!/bin/sh

function utils {
    python bin/registrar/app.py &
    node bin/authorizer/sqlite/app.js bin/apps/seed.json --dbname bin/authorizer/sqlite/authorizer.db &
    sleep 1s
}

function server_oauth {
    node bin/server-app/oauth-app &
}

function server_normalauth {
    node bin/server-app/normalauth-app &
}

function dashboard {
    utils; server_normalauth
    node bin/apps/dashboard/server/app.js &

    pushd bin/apps/dashboard/static
    python -m SimpleHTTPServer &
    popd
}

function test {
    utils; server_normalauth
    node bin/apps/test/server/app.js &
    
    pushd bin/apps/test/static
    python -m SimpleHTTPServer &
    popd
}

function mice {
    utils; server_normalauth
    node bin/apps/mice/server/app.js &
    
    pushd bin/apps/mice/static
    python -m SimpleHTTPServer &
    popd
}

function oauth {
    utils; server_oauth
    node bin/apps/oauth/server/app.js &
    
    pushd bin/apps/oauth/static
    python -m SimpleHTTPServer &
    popd
}

function stress {
    utils; server_normalauth
    node bin/apps/stress/server/app.js &
    
    pushd bin/apps/stress/static
    python -m SimpleHTTPServer &
    popd
}

function control_c {
    kill `jobs -p`
    exit $?
}

for i in $@
do
    $i
done

trap control_c SIGINT
while true; do read x; done